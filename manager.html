<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Gerenciador ‚Ä¢ Painel</title>
<style>
:root{
  --bg:#0f172a; --card:#0b1220; --text:#e5e7eb; --muted:#94a3b8; --primary:#2563eb;
  --line:#1f2937; --ok:#16a34a; --danger:#ef4444;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto}
header{position:sticky;top:0;background:var(--card);border-bottom:1px solid var(--line);display:flex;gap:14px;align-items:center;justify-content:space-between;padding:12px 18px;z-index:10}
nav a{color:var(--text);text-decoration:none;padding:10px 14px;border-radius:999px;background:#111827;border:1px solid var(--line)}
nav{display:flex;gap:8px;flex-wrap:wrap}
.container{max-width:1100px;margin:18px auto;padding:0 16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
h2{margin:0 0 12px}
.btn{cursor:pointer;border:0;border-radius:10px;padding:10px 14px;font-weight:600}
.btn-primary{background:var(--primary);color:#fff}
.btn-ghost{background:transparent;color:var(--text);border:1px solid var(--line)}
.muted{color:var(--muted)}
.badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#111827;border:1px solid var(--line);color:#cbd5e1}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.msg{margin-top:10px;padding:10px;border-radius:10px}
.ok{background:#064e3b;color:#a7f3d0} .err{background:#7f1d1d;color:#fecaca}
</style>
</head>
<body>
<header>
  <div class="row">
    <strong>üõ†Ô∏è Gerenciador</strong>
    <span id="who" class="badge">‚Ä¶</span>
  </div>
  <nav class="row">
    <a href="#" id="btnRefresh">Atualizar</a>
    <a href="#" id="btnLogout" class="btn-ghost">Sair</a>
  </nav>
</header>

<div class="container">
  <div class="card">
    <h2>Bem-vindo</h2>
    <p class="muted">Aqui voc√™ vai gerenciar o acesso do app <b>jr-app</b>, permiss√µes, bloqueios e clientes.</p>
    <div id="msg" class="msg" style="display:none"></div>
  </div>

  <div class="card" style="margin-top:14px">
    <h2>Aplicativos cadastrados</h2>
    <div id="apps" class="muted">Carregando‚Ä¶</div>
  </div>
</div>

<script>
const API_BASE = '<?= API_BASE ?>';
function show(kind, text){
  const el = document.getElementById('msg');
  el.className = 'msg '+(kind==='err'?'err':'ok');
  el.textContent = text;
  el.style.display = 'block';
}
async function post(path, body={}){
  const r = await fetch(API_BASE+"?path="+encodeURIComponent(path), {
    method:'POST', headers:{'Content-Type':'text/plain;charset=utf-8'},
    body: JSON.stringify(body)
  });
  return r.json();
}
const sess = (function(){ try{return JSON.parse(localStorage.getItem('mgr_session')||'{}')}catch(_){return{}} })();
if(!sess.token){ location.href = API_BASE + '?view=index'; }

document.getElementById('btnLogout').onclick = async (e)=>{
  e.preventDefault();
  try{ await post('/logout',{token:sess.token}); }catch(_){}
  localStorage.removeItem('mgr_session');
  location.href = API_BASE + '?view=index';
};
document.getElementById('btnRefresh').onclick = ()=> location.reload(true);

(async()=>{
  const me = await post('/me',{token:sess.token});
  if(me?.error){ show('err','Sess√£o inv√°lida ‚Äî fa√ßa login novamente.'); setTimeout(()=>location.href=API_BASE+'?view=index',1200); return; }
  document.getElementById('who').textContent = me.me;

  const apps = await post('/apps/list',{token:sess.token});
  if(apps?.error){ document.getElementById('apps').textContent = apps.error; return; }
  if(!apps.items?.length){ document.getElementById('apps').textContent = 'Nenhum app cadastrado ainda.'; return; }
  document.getElementById('apps').textContent = JSON.stringify(apps.items, null, 2);
})();
</script>
</body>
</html>
